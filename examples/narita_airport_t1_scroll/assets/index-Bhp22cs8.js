import{u as kn,a as Vn,j as $,C as bn}from"./fiber-eRm0wncS.js";import{r as Z}from"./react-4ldeB94U.js";import{M as nt,S as tt,b as et,c as rt}from"./drei-BAekAhF_.js";import{j as it,r as ot,s as ut,t as lt,u as ft,v as st,w as at,x as ct}from"./three-DvX3l9np.js";import{u as pt}from"./useControls-aK4G4mst.js";import{u as ht,a as gt}from"./spring-C8T-Vk3k.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))e(r);new MutationObserver(r=>{for(const f of r)if(f.type==="childList")for(const l of f.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&e(l)}).observe(document,{childList:!0,subtree:!0});function i(r){const f={};return r.integrity&&(f.integrity=r.integrity),r.referrerPolicy&&(f.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?f.credentials="include":r.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function e(r){if(r.ep)return;r.ep=!0;const f=i(r);fetch(r.href,f)}})();class vt{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const i=this._partials;let e=0;for(let r=0;r<this._n&&r<32;r++){const f=i[r],l=t+f,o=Math.abs(t)<Math.abs(f)?t-(l-f):f-(l-t);o&&(i[e++]=o),t=l}return i[e]=t,this._n=e+1,this}valueOf(){const t=this._partials;let i=this._n,e,r,f,l=0;if(i>0){for(l=t[--i];i>0&&(e=l,r=t[--i],l=e+r,f=r-(l-e),!f););i>0&&(f<0&&t[i-1]<0||f>0&&t[i-1]>0)&&(r=f*2,e=l+r,r==e-l&&(l=e))}return l}}function*St(n){for(const t of n)yield*t}function Wn(n){return Array.from(St(n))}var C=1e-6,dt=1e-12,_=Math.PI,Y=_/2,Pn=_/4,X=_*2,V=180/_,z=_/180,B=Math.abs,Xn=Math.atan,en=Math.atan2,A=Math.cos,yt=Math.exp,mt=Math.log,G=Math.sin,Et=Math.sign||function(n){return n>0?1:n<0?-1:0},Sn=Math.sqrt,Mt=Math.tan;function Rt(n){return n>1?0:n<-1?_:Math.acos(n)}function rn(n){return n>1?Y:n<-1?-Y:Math.asin(n)}function nn(){}function pn(n,t){n&&Ln.hasOwnProperty(n.type)&&Ln[n.type](n,t)}var xn={Feature:function(n,t){pn(n.geometry,t)},FeatureCollection:function(n,t){for(var i=n.features,e=-1,r=i.length;++e<r;)pn(i[e].geometry,t)}},Ln={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var i=n.coordinates,e=-1,r=i.length;++e<r;)n=i[e],t.point(n[0],n[1],n[2])},LineString:function(n,t){mn(n.coordinates,t,0)},MultiLineString:function(n,t){for(var i=n.coordinates,e=-1,r=i.length;++e<r;)mn(i[e],t,0)},Polygon:function(n,t){Cn(n.coordinates,t)},MultiPolygon:function(n,t){for(var i=n.coordinates,e=-1,r=i.length;++e<r;)Cn(i[e],t)},GeometryCollection:function(n,t){for(var i=n.geometries,e=-1,r=i.length;++e<r;)pn(i[e],t)}};function mn(n,t,i){var e=-1,r=n.length-i,f;for(t.lineStart();++e<r;)f=n[e],t.point(f[0],f[1],f[2]);t.lineEnd()}function Cn(n,t){var i=-1,e=n.length;for(t.polygonStart();++i<e;)mn(n[i],t,1);t.polygonEnd()}function Nt(n,t){n&&xn.hasOwnProperty(n.type)?xn[n.type](n,t):pn(n,t)}function En(n){return[en(n[1],n[0]),rn(n[2])]}function Q(n){var t=n[0],i=n[1],e=A(i);return[e*A(t),e*G(t),G(i)]}function ln(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function hn(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function dn(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function fn(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function Mn(n){var t=Sn(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function Rn(n,t){function i(e,r){return e=n(e,r),t(e[0],e[1])}return n.invert&&t.invert&&(i.invert=function(e,r){return e=t.invert(e,r),e&&n.invert(e[0],e[1])}),i}function Nn(n,t){return B(n)>_&&(n-=Math.round(n/X)*X),[n,t]}Nn.invert=Nn;function Jn(n,t,i){return(n%=X)?t||i?Rn(Bn(n),On(t,i)):Bn(n):t||i?On(t,i):Nn}function In(n){return function(t,i){return t+=n,B(t)>_&&(t-=Math.round(t/X)*X),[t,i]}}function Bn(n){var t=In(n);return t.invert=In(-n),t}function On(n,t){var i=A(n),e=G(n),r=A(t),f=G(t);function l(o,v){var g=A(v),u=A(o)*g,s=G(o)*g,a=G(v),h=a*i+u*e;return[en(s*r-h*f,u*i-a*e),rn(h*r+s*f)]}return l.invert=function(o,v){var g=A(v),u=A(o)*g,s=G(o)*g,a=G(v),h=a*r-s*f;return[en(s*r+a*f,u*i+h*e),rn(h*i-u*e)]},l}function Tt(n){n=Jn(n[0]*z,n[1]*z,n.length>2?n[2]*z:0);function t(i){return i=n(i[0]*z,i[1]*z),i[0]*=V,i[1]*=V,i}return t.invert=function(i){return i=n.invert(i[0]*z,i[1]*z),i[0]*=V,i[1]*=V,i},t}function wt(n,t,i,e,r,f){if(i){var l=A(t),o=G(t),v=e*i;r==null?(r=t+e*X,f=t-v/2):(r=An(l,r),f=An(l,f),(e>0?r<f:r>f)&&(r+=e*X));for(var g,u=r;e>0?u>f:u<f;u-=v)g=En([l,-o*A(u),-o*G(u)]),n.point(g[0],g[1])}}function An(n,t){t=Q(t),t[0]-=n,Mn(t);var i=Rt(-t[1]);return((-t[2]<0?-i:i)+X-C)%X}function Kn(){var n=[],t;return{point:function(i,e,r){t.push([i,e,r])},lineStart:function(){n.push(t=[])},lineEnd:nn,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var i=n;return n=[],t=null,i}}}function cn(n,t){return B(n[0]-t[0])<C&&B(n[1]-t[1])<C}function sn(n,t,i,e){this.x=n,this.z=t,this.o=i,this.e=e,this.v=!1,this.n=this.p=null}function Un(n,t,i,e,r){var f=[],l=[],o,v;if(n.forEach(function(p){if(!((y=p.length-1)<=0)){var y,S=p[0],T=p[y],m;if(cn(S,T)){if(!S[2]&&!T[2]){for(r.lineStart(),o=0;o<y;++o)r.point((S=p[o])[0],S[1]);r.lineEnd();return}T[0]+=2*C}f.push(m=new sn(S,p,null,!0)),l.push(m.o=new sn(S,null,m,!1)),f.push(m=new sn(T,p,null,!1)),l.push(m.o=new sn(T,null,m,!0))}}),!!f.length){for(l.sort(t),Gn(f),Gn(l),o=0,v=l.length;o<v;++o)l[o].e=i=!i;for(var g=f[0],u,s;;){for(var a=g,h=!0;a.v;)if((a=a.n)===g)return;u=a.z,r.lineStart();do{if(a.v=a.o.v=!0,a.e){if(h)for(o=0,v=u.length;o<v;++o)r.point((s=u[o])[0],s[1]);else e(a.x,a.n.x,1,r);a=a.n}else{if(h)for(u=a.p.z,o=u.length-1;o>=0;--o)r.point((s=u[o])[0],s[1]);else e(a.x,a.p.x,-1,r);a=a.p}a=a.o,u=a.z,h=!h}while(!a.v);r.lineEnd()}}}function Gn(n){if(t=n.length){for(var t,i=0,e=n[0],r;++i<t;)e.n=r=n[i],r.p=e,e=r;e.n=r=n[0],r.p=e}}function yn(n){return B(n[0])<=_?n[0]:Et(n[0])*((B(n[0])+_)%X-_)}function _t(n,t){var i=yn(t),e=t[1],r=G(e),f=[G(i),-A(i),0],l=0,o=0,v=new vt;r===1?e=Y+C:r===-1&&(e=-Y-C);for(var g=0,u=n.length;g<u;++g)if(a=(s=n[g]).length)for(var s,a,h=s[a-1],p=yn(h),y=h[1]/2+Pn,S=G(y),T=A(y),m=0;m<a;++m,p=d,S=N,T=x,h=E){var E=s[m],d=yn(E),R=E[1]/2+Pn,N=G(R),x=A(R),F=d-p,P=F>=0?1:-1,I=P*F,M=I>_,q=S*N;if(v.add(en(q*P*G(I),T*x+q*A(I))),l+=M?F+P*X:F,M^p>=i^d>=i){var O=hn(Q(h),Q(E));Mn(O);var L=hn(f,O);Mn(L);var c=(M^F>=0?-1:1)*rn(L[2]);(e>c||e===c&&(O[0]||O[1]))&&(o+=M^F>=0?1:-1)}}return(l<-C||l<C&&v<-dt)^o&1}function Zn(n,t,i,e){return function(r){var f=t(r),l=Kn(),o=t(l),v=!1,g,u,s,a={point:h,lineStart:y,lineEnd:S,polygonStart:function(){a.point=T,a.lineStart=m,a.lineEnd=E,u=[],g=[]},polygonEnd:function(){a.point=h,a.lineStart=y,a.lineEnd=S,u=Wn(u);var d=_t(g,e);u.length?(v||(r.polygonStart(),v=!0),Un(u,Pt,d,i,r)):d&&(v||(r.polygonStart(),v=!0),r.lineStart(),i(null,null,1,r),r.lineEnd()),v&&(r.polygonEnd(),v=!1),u=g=null},sphere:function(){r.polygonStart(),r.lineStart(),i(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function h(d,R){n(d,R)&&r.point(d,R)}function p(d,R){f.point(d,R)}function y(){a.point=p,f.lineStart()}function S(){a.point=h,f.lineEnd()}function T(d,R){s.push([d,R]),o.point(d,R)}function m(){o.lineStart(),s=[]}function E(){T(s[0][0],s[0][1]),o.lineEnd();var d=o.clean(),R=l.result(),N,x=R.length,F,P,I;if(s.pop(),g.push(s),s=null,!!x){if(d&1){if(P=R[0],(F=P.length-1)>0){for(v||(r.polygonStart(),v=!0),r.lineStart(),N=0;N<F;++N)r.point((I=P[N])[0],I[1]);r.lineEnd()}return}x>1&&d&2&&R.push(R.pop().concat(R.shift())),u.push(R.filter(Ft))}}return a}}function Ft(n){return n.length>1}function Pt(n,t){return((n=n.x)[0]<0?n[1]-Y-C:Y-n[1])-((t=t.x)[0]<0?t[1]-Y-C:Y-t[1])}const zn=Zn(function(){return!0},xt,Ct,[-_,-Y]);function xt(n){var t=NaN,i=NaN,e=NaN,r;return{lineStart:function(){n.lineStart(),r=1},point:function(f,l){var o=f>0?_:-_,v=B(f-t);B(v-_)<C?(n.point(t,i=(i+l)/2>0?Y:-Y),n.point(e,i),n.lineEnd(),n.lineStart(),n.point(o,i),n.point(f,i),r=0):e!==o&&v>=_&&(B(t-e)<C&&(t-=e*C),B(f-o)<C&&(f-=o*C),i=Lt(t,i,f,l),n.point(e,i),n.lineEnd(),n.lineStart(),n.point(o,i),r=0),n.point(t=f,i=l),e=o},lineEnd:function(){n.lineEnd(),t=i=NaN},clean:function(){return 2-r}}}function Lt(n,t,i,e){var r,f,l=G(n-i);return B(l)>C?Xn((G(t)*(f=A(e))*G(i)-G(e)*(r=A(t))*G(n))/(r*f*l)):(t+e)/2}function Ct(n,t,i,e){var r;if(n==null)r=i*Y,e.point(-_,r),e.point(0,r),e.point(_,r),e.point(_,0),e.point(_,-r),e.point(0,-r),e.point(-_,-r),e.point(-_,0),e.point(-_,r);else if(B(n[0]-t[0])>C){var f=n[0]<t[0]?_:-_;r=i*f/2,e.point(-f,r),e.point(0,r),e.point(f,r)}else e.point(t[0],t[1])}function It(n){var t=A(n),i=2*z,e=t>0,r=B(t)>C;function f(u,s,a,h){wt(h,n,i,a,u,s)}function l(u,s){return A(u)*A(s)>t}function o(u){var s,a,h,p,y;return{lineStart:function(){p=h=!1,y=1},point:function(S,T){var m=[S,T],E,d=l(S,T),R=e?d?0:g(S,T):d?g(S+(S<0?_:-_),T):0;if(!s&&(p=h=d)&&u.lineStart(),d!==h&&(E=v(s,m),(!E||cn(s,E)||cn(m,E))&&(m[2]=1)),d!==h)y=0,d?(u.lineStart(),E=v(m,s),u.point(E[0],E[1])):(E=v(s,m),u.point(E[0],E[1],2),u.lineEnd()),s=E;else if(r&&s&&e^d){var N;!(R&a)&&(N=v(m,s,!0))&&(y=0,e?(u.lineStart(),u.point(N[0][0],N[0][1]),u.point(N[1][0],N[1][1]),u.lineEnd()):(u.point(N[1][0],N[1][1]),u.lineEnd(),u.lineStart(),u.point(N[0][0],N[0][1],3)))}d&&(!s||!cn(s,m))&&u.point(m[0],m[1]),s=m,h=d,a=R},lineEnd:function(){h&&u.lineEnd(),s=null},clean:function(){return y|(p&&h)<<1}}}function v(u,s,a){var h=Q(u),p=Q(s),y=[1,0,0],S=hn(h,p),T=ln(S,S),m=S[0],E=T-m*m;if(!E)return!a&&u;var d=t*T/E,R=-t*m/E,N=hn(y,S),x=fn(y,d),F=fn(S,R);dn(x,F);var P=N,I=ln(x,P),M=ln(P,P),q=I*I-M*(ln(x,x)-1);if(!(q<0)){var O=Sn(q),L=fn(P,(-I-O)/M);if(dn(L,x),L=En(L),!a)return L;var c=u[0],w=s[0],D=u[1],H=s[1],W;w<c&&(W=c,c=w,w=W);var b=w-c,J=B(b-_)<C,U=J||b<C;if(!J&&H<D&&(W=D,D=H,H=W),U?J?D+H>0^L[1]<(B(L[0]-c)<C?D:H):D<=L[1]&&L[1]<=H:b>_^(c<=L[0]&&L[0]<=w)){var K=fn(P,(-I+O)/M);return dn(K,x),[L,En(K)]}}}function g(u,s){var a=e?n:_-n,h=0;return u<-a?h|=1:u>a&&(h|=2),s<-a?h|=4:s>a&&(h|=8),h}return Zn(l,o,f,e?[0,-n]:[-_,n-_])}function Bt(n,t,i,e,r,f){var l=n[0],o=n[1],v=t[0],g=t[1],u=0,s=1,a=v-l,h=g-o,p;if(p=i-l,!(!a&&p>0)){if(p/=a,a<0){if(p<u)return;p<s&&(s=p)}else if(a>0){if(p>s)return;p>u&&(u=p)}if(p=r-l,!(!a&&p<0)){if(p/=a,a<0){if(p>s)return;p>u&&(u=p)}else if(a>0){if(p<u)return;p<s&&(s=p)}if(p=e-o,!(!h&&p>0)){if(p/=h,h<0){if(p<u)return;p<s&&(s=p)}else if(h>0){if(p>s)return;p>u&&(u=p)}if(p=f-o,!(!h&&p<0)){if(p/=h,h<0){if(p>s)return;p>u&&(u=p)}else if(h>0){if(p<u)return;p<s&&(s=p)}return u>0&&(n[0]=l+u*a,n[1]=o+u*h),s<1&&(t[0]=l+s*a,t[1]=o+s*h),!0}}}}}var tn=1e9,an=-tn;function Ot(n,t,i,e){function r(g,u){return n<=g&&g<=i&&t<=u&&u<=e}function f(g,u,s,a){var h=0,p=0;if(g==null||(h=l(g,s))!==(p=l(u,s))||v(g,u)<0^s>0)do a.point(h===0||h===3?n:i,h>1?e:t);while((h=(h+s+4)%4)!==p);else a.point(u[0],u[1])}function l(g,u){return B(g[0]-n)<C?u>0?0:3:B(g[0]-i)<C?u>0?2:1:B(g[1]-t)<C?u>0?1:0:u>0?3:2}function o(g,u){return v(g.x,u.x)}function v(g,u){var s=l(g,1),a=l(u,1);return s!==a?s-a:s===0?u[1]-g[1]:s===1?g[0]-u[0]:s===2?g[1]-u[1]:u[0]-g[0]}return function(g){var u=g,s=Kn(),a,h,p,y,S,T,m,E,d,R,N,x={point:F,lineStart:q,lineEnd:O,polygonStart:I,polygonEnd:M};function F(c,w){r(c,w)&&u.point(c,w)}function P(){for(var c=0,w=0,D=h.length;w<D;++w)for(var H=h[w],W=1,b=H.length,J=H[0],U,K,un=J[0],j=J[1];W<b;++W)U=un,K=j,J=H[W],un=J[0],j=J[1],K<=e?j>e&&(un-U)*(e-K)>(j-K)*(n-U)&&++c:j<=e&&(un-U)*(e-K)<(j-K)*(n-U)&&--c;return c}function I(){u=s,a=[],h=[],N=!0}function M(){var c=P(),w=N&&c,D=(a=Wn(a)).length;(w||D)&&(g.polygonStart(),w&&(g.lineStart(),f(null,null,1,g),g.lineEnd()),D&&Un(a,o,c,f,g),g.polygonEnd()),u=g,a=h=p=null}function q(){x.point=L,h&&h.push(p=[]),R=!0,d=!1,m=E=NaN}function O(){a&&(L(y,S),T&&d&&s.rejoin(),a.push(s.result())),x.point=F,d&&u.lineEnd()}function L(c,w){var D=r(c,w);if(h&&p.push([c,w]),R)y=c,S=w,T=D,R=!1,D&&(u.lineStart(),u.point(c,w));else if(D&&d)u.point(c,w);else{var H=[m=Math.max(an,Math.min(tn,m)),E=Math.max(an,Math.min(tn,E))],W=[c=Math.max(an,Math.min(tn,c)),w=Math.max(an,Math.min(tn,w))];Bt(H,W,n,t,i,e)?(d||(u.lineStart(),u.point(H[0],H[1])),u.point(W[0],W[1]),D||u.lineEnd(),N=!1):D&&(u.lineStart(),u.point(c,w),N=!1)}m=c,E=w,d=D}return x}}const $n=n=>n;var k=1/0,gn=k,on=-k,vn=on,Dn={point:At,lineStart:nn,lineEnd:nn,polygonStart:nn,polygonEnd:nn,result:function(){var n=[[k,gn],[on,vn]];return on=vn=-(gn=k=1/0),n}};function At(n,t){n<k&&(k=n),n>on&&(on=n),t<gn&&(gn=t),t>vn&&(vn=t)}function wn(n){return function(t){var i=new Tn;for(var e in n)i[e]=n[e];return i.stream=t,i}}function Tn(){}Tn.prototype={constructor:Tn,point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function _n(n,t,i){var e=n.clipExtent&&n.clipExtent();return n.scale(150).translate([0,0]),e!=null&&n.clipExtent(null),Nt(i,n.stream(Dn)),t(Dn.result()),e!=null&&n.clipExtent(e),n}function jn(n,t,i){return _n(n,function(e){var r=t[1][0]-t[0][0],f=t[1][1]-t[0][1],l=Math.min(r/(e[1][0]-e[0][0]),f/(e[1][1]-e[0][1])),o=+t[0][0]+(r-l*(e[1][0]+e[0][0]))/2,v=+t[0][1]+(f-l*(e[1][1]+e[0][1]))/2;n.scale(150*l).translate([o,v])},i)}function Gt(n,t,i){return jn(n,[[0,0],t],i)}function zt(n,t,i){return _n(n,function(e){var r=+t,f=r/(e[1][0]-e[0][0]),l=(r-f*(e[1][0]+e[0][0]))/2,o=-f*e[0][1];n.scale(150*f).translate([l,o])},i)}function $t(n,t,i){return _n(n,function(e){var r=+t,f=r/(e[1][1]-e[0][1]),l=-f*e[0][0],o=(r-f*(e[1][1]+e[0][1]))/2;n.scale(150*f).translate([l,o])},i)}var qn=16,Dt=A(30*z);function Hn(n,t){return+t?Ht(n,t):qt(n)}function qt(n){return wn({point:function(t,i){t=n(t,i),this.stream.point(t[0],t[1])}})}function Ht(n,t){function i(e,r,f,l,o,v,g,u,s,a,h,p,y,S){var T=g-e,m=u-r,E=T*T+m*m;if(E>4*t&&y--){var d=l+a,R=o+h,N=v+p,x=Sn(d*d+R*R+N*N),F=rn(N/=x),P=B(B(N)-1)<C||B(f-s)<C?(f+s)/2:en(R,d),I=n(P,F),M=I[0],q=I[1],O=M-e,L=q-r,c=m*O-T*L;(c*c/E>t||B((T*O+m*L)/E-.5)>.3||l*a+o*h+v*p<Dt)&&(i(e,r,f,l,o,v,M,q,P,d/=x,R/=x,N,y,S),S.point(M,q),i(M,q,P,d,R,N,g,u,s,a,h,p,y,S))}}return function(e){var r,f,l,o,v,g,u,s,a,h,p,y,S={point:T,lineStart:m,lineEnd:d,polygonStart:function(){e.polygonStart(),S.lineStart=R},polygonEnd:function(){e.polygonEnd(),S.lineStart=m}};function T(F,P){F=n(F,P),e.point(F[0],F[1])}function m(){s=NaN,S.point=E,e.lineStart()}function E(F,P){var I=Q([F,P]),M=n(F,P);i(s,a,u,h,p,y,s=M[0],a=M[1],u=F,h=I[0],p=I[1],y=I[2],qn,e),e.point(s,a)}function d(){S.point=T,e.lineEnd()}function R(){m(),S.point=N,S.lineEnd=x}function N(F,P){E(r=F,P),f=s,l=a,o=h,v=p,g=y,S.point=E}function x(){i(s,a,u,h,p,y,f,l,r,o,v,g,qn,e),S.lineEnd=d,d()}return S}}var Yt=wn({point:function(n,t){this.stream.point(n*z,t*z)}});function Vt(n){return wn({point:function(t,i){var e=n(t,i);return this.stream.point(e[0],e[1])}})}function Wt(n,t,i,e,r){function f(l,o){return l*=e,o*=r,[t+n*l,i-n*o]}return f.invert=function(l,o){return[(l-t)/n*e,(i-o)/n*r]},f}function Yn(n,t,i,e,r,f){if(!f)return Wt(n,t,i,e,r);var l=A(f),o=G(f),v=l*n,g=o*n,u=l/n,s=o/n,a=(o*i-l*t)/n,h=(o*t+l*i)/n;function p(y,S){return y*=e,S*=r,[v*y-g*S+t,i-g*y-v*S]}return p.invert=function(y,S){return[e*(u*y-s*S+a),r*(h-s*y-u*S)]},p}function Xt(n){return Jt(function(){return n})()}function Jt(n){var t,i=150,e=480,r=250,f=0,l=0,o=0,v=0,g=0,u,s=0,a=1,h=1,p=null,y=zn,S=null,T,m,E,d=$n,R=.5,N,x,F,P,I;function M(c){return F(c[0]*z,c[1]*z)}function q(c){return c=F.invert(c[0],c[1]),c&&[c[0]*V,c[1]*V]}M.stream=function(c){return P&&I===c?P:P=Yt(Vt(u)(y(N(d(I=c)))))},M.preclip=function(c){return arguments.length?(y=c,p=void 0,L()):y},M.postclip=function(c){return arguments.length?(d=c,S=T=m=E=null,L()):d},M.clipAngle=function(c){return arguments.length?(y=+c?It(p=c*z):(p=null,zn),L()):p*V},M.clipExtent=function(c){return arguments.length?(d=c==null?(S=T=m=E=null,$n):Ot(S=+c[0][0],T=+c[0][1],m=+c[1][0],E=+c[1][1]),L()):S==null?null:[[S,T],[m,E]]},M.scale=function(c){return arguments.length?(i=+c,O()):i},M.translate=function(c){return arguments.length?(e=+c[0],r=+c[1],O()):[e,r]},M.center=function(c){return arguments.length?(f=c[0]%360*z,l=c[1]%360*z,O()):[f*V,l*V]},M.rotate=function(c){return arguments.length?(o=c[0]%360*z,v=c[1]%360*z,g=c.length>2?c[2]%360*z:0,O()):[o*V,v*V,g*V]},M.angle=function(c){return arguments.length?(s=c%360*z,O()):s*V},M.reflectX=function(c){return arguments.length?(a=c?-1:1,O()):a<0},M.reflectY=function(c){return arguments.length?(h=c?-1:1,O()):h<0},M.precision=function(c){return arguments.length?(N=Hn(x,R=c*c),L()):Sn(R)},M.fitExtent=function(c,w){return jn(M,c,w)},M.fitSize=function(c,w){return Gt(M,c,w)},M.fitWidth=function(c,w){return zt(M,c,w)},M.fitHeight=function(c,w){return $t(M,c,w)};function O(){var c=Yn(i,0,0,a,h,s).apply(null,t(f,l)),w=Yn(i,e-c[0],r-c[1],a,h,s);return u=Jn(o,v,g),x=Rn(t,w),F=Rn(u,x),N=Hn(x,R),L()}function L(){return P=I=null,M}return function(){return t=n.apply(this,arguments),M.invert=t.invert&&q,O()}}function Fn(n,t){return[n,mt(Mt((Y+t)/2))]}Fn.invert=function(n,t){return[n,2*Xn(yt(t))-Y]};function Kt(){return Ut(Fn).scale(961/X)}function Ut(n){var t=Xt(n),i=t.center,e=t.scale,r=t.translate,f=t.clipExtent,l=null,o,v,g;t.scale=function(s){return arguments.length?(e(s),u()):e()},t.translate=function(s){return arguments.length?(r(s),u()):r()},t.center=function(s){return arguments.length?(i(s),u()):i()},t.clipExtent=function(s){return arguments.length?(s==null?l=o=v=g=null:(l=+s[0][0],o=+s[0][1],v=+s[1][0],g=+s[1][1]),u()):l==null?null:[[l,o],[v,g]]};function u(){var s=_*e(),a=t(Tt(t.rotate()).invert([0,0]));return f(l==null?[[a[0]-s,a[1]-s],[a[0]+s,a[1]+s]]:n===Fn?[[Math.max(a[0]-s,l),o],[Math.min(a[0]+s,v),g]]:[[l,Math.max(a[1]-s,o)],[v,Math.min(a[1]+s,g)]])}return u()}function Qn(n,t){function i(e){const r=e.type,f=e.coordinates;switch(r){case"Point":return t(f);case"MultiPoint":return f.map(l=>t(l));case"LineString":return f.map(l=>t(l));case"MultiLineString":return f.map(l=>l.map(o=>t(o)));case"Polygon":return f.map(l=>l.map(o=>t(o)));case"MultiPolygon":return f.map(l=>l.map(o=>o.map(v=>t(v))));case"GeometryCollection":return{type:"GeometryCollection",geometries:e.geometries.map(l=>i(l))};default:throw new Error("Unsupported geometry type: "+r)}}return n.type==="Feature"?{type:"Feature",geometry:i(n.geometry),properties:n.properties}:n.type==="FeatureCollection"?{type:"FeatureCollection",features:n.features.map(e=>Qn(e,t))}:(n.type==="GeometryCollection",i(n))}const Zt=(n,t)=>{const i=new at;return n[0].forEach((e,r)=>{const[f,l]=e.map((o,v)=>o);r===0?i.moveTo(f,l):r+1===n[0].length?i.closePath():i.lineTo(f,l)}),new ct(i,{steps:1,depth:t,bevelEnabled:!1})},jt=async(n,t,i)=>{const e=await fetch(n).then(o=>o.json()),r=Kt().fitExtent([[0,0],[30,30]],e),f=Qn(e,r),l=Qt({data:f,fill:t.fill,stroke:t.stroke});i(l)};function Qt({data:n,fill:t,stroke:i}=props){const e=[];return n.features.filter(r=>r.geometry).forEach(r=>{const f=Zt(r.geometry,.01),l=new it().makeRotationX(Math.PI/-2);f.applyMatrix4(l);const o=new ot({color:t}),v=new ut(f,o);v.userData={properties:r.properties};const g=new lt(f),u=new ft({color:i}),s=new st(g,u);e.push({mesh:v,edges:s,properties:r.properties})}),e}const kt=({name:n,position:t,floorData:i,visible:e,edgesOnly:r})=>{const[f,l]=Z.useState(!0),{positionSpring:o}=ht({positionSpring:e?t:[t[0],t[1]+2,t[2]],config:{mass:1,tension:170,friction:26},onStart:()=>{l(!0)},onRest:()=>{l(e)}});return $.jsx(gt.group,{name:n,position:o,visible:f,children:i.map((v,g)=>$.jsx("group",{name:`${n}_${v.name}`,"position-y":v.positionY,children:v.meshes.map(({mesh:u,edges:s,properties:a},h)=>$.jsxs("group",{children:[!r&&$.jsx("primitive",{object:u,onClick:p=>{if(!e)return;const y=document.querySelector("#tooltip"),S=y.clientWidth;y.style.visibility="visible",y.style.top=`${p.layerY}px`,y.style.left=`${p.layerX-S/2}px`;const m="<table>"+Object.keys(a).map(E=>`<tr><th>${E}</th><td>${a[E]}</td></tr>`).join("")+"</table>";y.innerHTML=m,p.stopPropagation()},onPointerOut:()=>{console.log("pointout")}}),$.jsx("primitive",{object:s})]},h))},g))})};function bt(){const[n,t]=Z.useState({}),i=et(),[e,r]=Z.useState({NRT2_4out:!0,NRT2_4:!0,NRT2_3out:!0,NRT2_3:!0,NRT2_2:!0,NRT2_1:!0,NRT2_B1:!0,NRT2_B1out:!0,NRT2_B2:!0}),f=pt("ワイヤーフレーム",{edgesOnly:{value:!1,label:"on"}});return Vn(()=>{const l=i.range(0,1);l>.1?r(o=>({...o,NRT2_4out:!1})):r(o=>({...o,NRT2_4out:!0})),l>.2?r(o=>({...o,NRT2_4:!1})):r(o=>({...o,NRT2_4:!0})),l>.3?r(o=>({...o,NRT2_3out:!1})):r(o=>({...o,NRT2_3out:!0})),l>.4?r(o=>({...o,NRT2_3:!1})):r(o=>({...o,NRT2_3:!0})),l>.5?r(o=>({...o,NRT2_2:!1})):r(o=>({...o,NRT2_2:!0})),l>.6?r(o=>({...o,NRT2_1:!1})):r(o=>({...o,NRT2_1:!0})),l>.7?r(o=>({...o,NRT2_B1:!1})):r(o=>({...o,NRT2_B1:!0})),l>.8?r(o=>({...o,NRT2_B1out:!1})):r(o=>({...o,NRT2_B1out:!0})),l>.9?r(o=>({...o,NRT2_B2:!1})):r(o=>({...o,NRT2_B2:!0}))}),Z.useEffect(()=>{[{floor:"NRT2_B2",position:[-15,-4,15],files:["Space","Fixture","Floor"],colors:[65280,16711680,16753920]},{floor:"NRT2_B1out",position:[-15,-2,15],files:["Space","Fixture","Floor"],colors:[65280,16711680,16753920]},{floor:"NRT2_B1",position:[-15,-2,15],files:["Space","Fixture","Floor"],colors:[65280,16711680,16753920]},{floor:"NRT2_1",position:[-15,0,15],files:["Space","Fixture","Floor"],colors:[65280,16711680,16753920]},{floor:"NRT2_2",position:[-15,2,15],files:["Space","Fixture","Floor"],colors:[65280,16711680,16753920]},{floor:"NRT2_3",position:[-15,4,15],files:["Space","Fixture","Floor"],colors:[65280,16711680,16753920]},{floor:"NRT2_3out",position:[-15,4,15],files:["Space","Fixture","Floor"],colors:[65280,16711680,16753920]},{floor:"NRT2_4",position:[-15,6,15],files:["Space","Fixture","Floor"],colors:[65280,16711680,16753920]},{floor:"NRT2_4out",position:[-15,6,15],files:["Space","Fixture","Floor"],colors:[65280,16711680,16753920]}].forEach(async({floor:o,position:v,files:g,colors:u})=>{const s=[];for(let a=0;a<g.length;a++){const[h,p]=[g[a],u[a]];await jt(`./data/${o}/${o}_${h}.geojson`,{fill:p,stroke:255},y=>{s.push({name:h,positionY:a===0?0:a===1?.05:-.05,meshes:y})})}t(a=>({...a,[o]:{position:v,floorData:s}}))})},[]),$.jsx("group",{children:Object.entries(n).map(([l,{position:o,floorData:v}])=>$.jsx(kt,{name:l,position:o,floorData:v,visible:e[l],edgesOnly:f.edgesOnly},l))})}function ne(){const n=Z.useRef(),{camera:t,gl:i}=kn();return Vn(()=>{n.current.update()}),Z.useEffect(()=>{if(n.current){const e=()=>{const r=document.querySelector("#tooltip");r.style.visibility="hidden",r.innerHTML=""};return n.current.addEventListener("change",e),()=>{n.current.removeEventListener("change",e)}}},[n]),$.jsxs($.Fragment,{children:[$.jsx(nt,{ref:n,args:[t,i.domElement],enableDamping:!0,dampingFactor:.05,minDistance:1,maxAzimuthAngle:500,maxPolarAngle:Math.PI/2,enableZoom:!1}),$.jsx("ambientLight",{intensity:10}),$.jsx(tt,{pages:9*1.5,damping:0,children:$.jsx(bt,{})})]})}function te(){return $.jsxs($.Fragment,{children:[$.jsx(bn,{shadows:!0,camera:{position:[-15,10,-5]},children:$.jsx(ne,{})}),$.jsx("div",{id:"tooltip"})]})}rt(document.getElementById("root")).render($.jsx(Z.StrictMode,{children:$.jsx(te,{})}));
