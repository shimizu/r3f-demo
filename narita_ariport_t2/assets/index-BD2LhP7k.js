import{u as kn,a as bn,j as D,C as nt}from"./fiber-D6qrppPU.js";import{r as Z}from"./react-4ldeB94U.js";import{M as tt,c as et}from"./drei-BPRCQ3eM.js";import{o as it,p as rt,q as ot,r as lt,s as ut,t as ft,u as at,v as ct}from"./three-CZvZYpnZ.js";import{u as xn}from"./useControls-Cq_p-7yt.js";import{u as st,a as pt}from"./spring-CzryguQc.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))e(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const f of l.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&e(f)}).observe(document,{childList:!0,subtree:!0});function i(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function e(r){if(r.ep)return;r.ep=!0;const l=i(r);fetch(r.href,l)}})();class ht{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const i=this._partials;let e=0;for(let r=0;r<this._n&&r<32;r++){const l=i[r],f=t+l,c=Math.abs(t)<Math.abs(l)?t-(f-l):l-(f-t);c&&(i[e++]=c),t=f}return i[e]=t,this._n=e+1,this}valueOf(){const t=this._partials;let i=this._n,e,r,l,f=0;if(i>0){for(f=t[--i];i>0&&(e=f,r=t[--i],f=e+r,l=r-(f-e),!l););i>0&&(l<0&&t[i-1]<0||l>0&&t[i-1]>0)&&(r=l*2,e=f+r,r==e-f&&(f=e))}return f}}function*vt(n){for(const t of n)yield*t}function Xn(n){return Array.from(vt(n))}var C=1e-6,gt=1e-12,F=Math.PI,Y=F/2,Ln=F/4,J=F*2,W=180/F,z=F/180,O=Math.abs,Jn=Math.atan,en=Math.atan2,G=Math.cos,St=Math.exp,dt=Math.log,B=Math.sin,yt=Math.sign||function(n){return n>0?1:n<0?-1:0},Sn=Math.sqrt,Et=Math.tan;function mt(n){return n>1?0:n<-1?F:Math.acos(n)}function rn(n){return n>1?Y:n<-1?-Y:Math.asin(n)}function nn(){}function pn(n,t){n&&Cn.hasOwnProperty(n.type)&&Cn[n.type](n,t)}var _n={Feature:function(n,t){pn(n.geometry,t)},FeatureCollection:function(n,t){for(var i=n.features,e=-1,r=i.length;++e<r;)pn(i[e].geometry,t)}},Cn={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var i=n.coordinates,e=-1,r=i.length;++e<r;)n=i[e],t.point(n[0],n[1],n[2])},LineString:function(n,t){En(n.coordinates,t,0)},MultiLineString:function(n,t){for(var i=n.coordinates,e=-1,r=i.length;++e<r;)En(i[e],t,0)},Polygon:function(n,t){In(n.coordinates,t)},MultiPolygon:function(n,t){for(var i=n.coordinates,e=-1,r=i.length;++e<r;)In(i[e],t)},GeometryCollection:function(n,t){for(var i=n.geometries,e=-1,r=i.length;++e<r;)pn(i[e],t)}};function En(n,t,i){var e=-1,r=n.length-i,l;for(t.lineStart();++e<r;)l=n[e],t.point(l[0],l[1],l[2]);t.lineEnd()}function In(n,t){var i=-1,e=n.length;for(t.polygonStart();++i<e;)En(n[i],t,1);t.polygonEnd()}function Mt(n,t){n&&_n.hasOwnProperty(n.type)?_n[n.type](n,t):pn(n,t)}function mn(n){return[en(n[1],n[0]),rn(n[2])]}function j(n){var t=n[0],i=n[1],e=G(i);return[e*G(t),e*B(t),B(i)]}function un(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function hn(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function dn(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function fn(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function Mn(n){var t=Sn(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function wn(n,t){function i(e,r){return e=n(e,r),t(e[0],e[1])}return n.invert&&t.invert&&(i.invert=function(e,r){return e=t.invert(e,r),e&&n.invert(e[0],e[1])}),i}function Rn(n,t){return O(n)>F&&(n-=Math.round(n/J)*J),[n,t]}Rn.invert=Rn;function Vn(n,t,i){return(n%=J)?t||i?wn(An(n),Gn(t,i)):An(n):t||i?Gn(t,i):Rn}function On(n){return function(t,i){return t+=n,O(t)>F&&(t-=Math.round(t/J)*J),[t,i]}}function An(n){var t=On(n);return t.invert=On(-n),t}function Gn(n,t){var i=G(n),e=B(n),r=G(t),l=B(t);function f(c,g){var v=G(g),o=G(c)*v,u=B(c)*v,a=B(g),p=a*i+o*e;return[en(u*r-p*l,o*i-a*e),rn(p*r+u*l)]}return f.invert=function(c,g){var v=G(g),o=G(c)*v,u=B(c)*v,a=B(g),p=a*r-u*l;return[en(u*r+a*l,o*i+p*e),rn(p*i-o*e)]},f}function wt(n){n=Vn(n[0]*z,n[1]*z,n.length>2?n[2]*z:0);function t(i){return i=n(i[0]*z,i[1]*z),i[0]*=W,i[1]*=W,i}return t.invert=function(i){return i=n.invert(i[0]*z,i[1]*z),i[0]*=W,i[1]*=W,i},t}function Rt(n,t,i,e,r,l){if(i){var f=G(t),c=B(t),g=e*i;r==null?(r=t+e*J,l=t-g/2):(r=Bn(f,r),l=Bn(f,l),(e>0?r<l:r>l)&&(r+=e*J));for(var v,o=r;e>0?o>l:o<l;o-=g)v=mn([f,-c*G(o),-c*B(o)]),n.point(v[0],v[1])}}function Bn(n,t){t=j(t),t[0]-=n,Mn(t);var i=mt(-t[1]);return((-t[2]<0?-i:i)+J-C)%J}function Kn(){var n=[],t;return{point:function(i,e,r){t.push([i,e,r])},lineStart:function(){n.push(t=[])},lineEnd:nn,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var i=n;return n=[],t=null,i}}}function sn(n,t){return O(n[0]-t[0])<C&&O(n[1]-t[1])<C}function an(n,t,i,e){this.x=n,this.z=t,this.o=i,this.e=e,this.v=!1,this.n=this.p=null}function Un(n,t,i,e,r){var l=[],f=[],c,g;if(n.forEach(function(h){if(!((y=h.length-1)<=0)){var y,S=h[0],N=h[y],E;if(sn(S,N)){if(!S[2]&&!N[2]){for(r.lineStart(),c=0;c<y;++c)r.point((S=h[c])[0],S[1]);r.lineEnd();return}N[0]+=2*C}l.push(E=new an(S,h,null,!0)),f.push(E.o=new an(S,null,E,!1)),l.push(E=new an(N,h,null,!1)),f.push(E.o=new an(N,null,E,!0))}}),!!l.length){for(f.sort(t),zn(l),zn(f),c=0,g=f.length;c<g;++c)f[c].e=i=!i;for(var v=l[0],o,u;;){for(var a=v,p=!0;a.v;)if((a=a.n)===v)return;o=a.z,r.lineStart();do{if(a.v=a.o.v=!0,a.e){if(p)for(c=0,g=o.length;c<g;++c)r.point((u=o[c])[0],u[1]);else e(a.x,a.n.x,1,r);a=a.n}else{if(p)for(o=a.p.z,c=o.length-1;c>=0;--c)r.point((u=o[c])[0],u[1]);else e(a.x,a.p.x,-1,r);a=a.p}a=a.o,o=a.z,p=!p}while(!a.v);r.lineEnd()}}}function zn(n){if(t=n.length){for(var t,i=0,e=n[0],r;++i<t;)e.n=r=n[i],r.p=e,e=r;e.n=r=n[0],r.p=e}}function yn(n){return O(n[0])<=F?n[0]:yt(n[0])*((O(n[0])+F)%J-F)}function Nt(n,t){var i=yn(t),e=t[1],r=B(e),l=[B(i),-G(i),0],f=0,c=0,g=new ht;r===1?e=Y+C:r===-1&&(e=-Y-C);for(var v=0,o=n.length;v<o;++v)if(a=(u=n[v]).length)for(var u,a,p=u[a-1],h=yn(p),y=p[1]/2+Ln,S=B(y),N=G(y),E=0;E<a;++E,h=d,S=R,N=L,p=m){var m=u[E],d=yn(m),w=m[1]/2+Ln,R=B(w),L=G(w),T=d-h,x=T>=0?1:-1,I=x*T,M=I>F,q=S*R;if(g.add(en(q*x*B(I),N*L+q*G(I))),f+=M?T+x*J:T,M^h>=i^d>=i){var A=hn(j(p),j(m));Mn(A);var _=hn(l,A);Mn(_);var s=(M^T>=0?-1:1)*rn(_[2]);(e>s||e===s&&(A[0]||A[1]))&&(c+=M^T>=0?1:-1)}}return(f<-C||f<C&&g<-gt)^c&1}function Qn(n,t,i,e){return function(r){var l=t(r),f=Kn(),c=t(f),g=!1,v,o,u,a={point:p,lineStart:y,lineEnd:S,polygonStart:function(){a.point=N,a.lineStart=E,a.lineEnd=m,o=[],v=[]},polygonEnd:function(){a.point=p,a.lineStart=y,a.lineEnd=S,o=Xn(o);var d=Nt(v,e);o.length?(g||(r.polygonStart(),g=!0),Un(o,Ft,d,i,r)):d&&(g||(r.polygonStart(),g=!0),r.lineStart(),i(null,null,1,r),r.lineEnd()),g&&(r.polygonEnd(),g=!1),o=v=null},sphere:function(){r.polygonStart(),r.lineStart(),i(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function p(d,w){n(d,w)&&r.point(d,w)}function h(d,w){l.point(d,w)}function y(){a.point=h,l.lineStart()}function S(){a.point=p,l.lineEnd()}function N(d,w){u.push([d,w]),c.point(d,w)}function E(){c.lineStart(),u=[]}function m(){N(u[0][0],u[0][1]),c.lineEnd();var d=c.clean(),w=f.result(),R,L=w.length,T,x,I;if(u.pop(),v.push(u),u=null,!!L){if(d&1){if(x=w[0],(T=x.length-1)>0){for(g||(r.polygonStart(),g=!0),r.lineStart(),R=0;R<T;++R)r.point((I=x[R])[0],I[1]);r.lineEnd()}return}L>1&&d&2&&w.push(w.pop().concat(w.shift())),o.push(w.filter(Pt))}}return a}}function Pt(n){return n.length>1}function Ft(n,t){return((n=n.x)[0]<0?n[1]-Y-C:Y-n[1])-((t=t.x)[0]<0?t[1]-Y-C:Y-t[1])}const $n=Qn(function(){return!0},Tt,Lt,[-F,-Y]);function Tt(n){var t=NaN,i=NaN,e=NaN,r;return{lineStart:function(){n.lineStart(),r=1},point:function(l,f){var c=l>0?F:-F,g=O(l-t);O(g-F)<C?(n.point(t,i=(i+f)/2>0?Y:-Y),n.point(e,i),n.lineEnd(),n.lineStart(),n.point(c,i),n.point(l,i),r=0):e!==c&&g>=F&&(O(t-e)<C&&(t-=e*C),O(l-c)<C&&(l-=c*C),i=xt(t,i,l,f),n.point(e,i),n.lineEnd(),n.lineStart(),n.point(c,i),r=0),n.point(t=l,i=f),e=c},lineEnd:function(){n.lineEnd(),t=i=NaN},clean:function(){return 2-r}}}function xt(n,t,i,e){var r,l,f=B(n-i);return O(f)>C?Jn((B(t)*(l=G(e))*B(i)-B(e)*(r=G(t))*B(n))/(r*l*f)):(t+e)/2}function Lt(n,t,i,e){var r;if(n==null)r=i*Y,e.point(-F,r),e.point(0,r),e.point(F,r),e.point(F,0),e.point(F,-r),e.point(0,-r),e.point(-F,-r),e.point(-F,0),e.point(-F,r);else if(O(n[0]-t[0])>C){var l=n[0]<t[0]?F:-F;r=i*l/2,e.point(-l,r),e.point(0,r),e.point(l,r)}else e.point(t[0],t[1])}function _t(n){var t=G(n),i=2*z,e=t>0,r=O(t)>C;function l(o,u,a,p){Rt(p,n,i,a,o,u)}function f(o,u){return G(o)*G(u)>t}function c(o){var u,a,p,h,y;return{lineStart:function(){h=p=!1,y=1},point:function(S,N){var E=[S,N],m,d=f(S,N),w=e?d?0:v(S,N):d?v(S+(S<0?F:-F),N):0;if(!u&&(h=p=d)&&o.lineStart(),d!==p&&(m=g(u,E),(!m||sn(u,m)||sn(E,m))&&(E[2]=1)),d!==p)y=0,d?(o.lineStart(),m=g(E,u),o.point(m[0],m[1])):(m=g(u,E),o.point(m[0],m[1],2),o.lineEnd()),u=m;else if(r&&u&&e^d){var R;!(w&a)&&(R=g(E,u,!0))&&(y=0,e?(o.lineStart(),o.point(R[0][0],R[0][1]),o.point(R[1][0],R[1][1]),o.lineEnd()):(o.point(R[1][0],R[1][1]),o.lineEnd(),o.lineStart(),o.point(R[0][0],R[0][1],3)))}d&&(!u||!sn(u,E))&&o.point(E[0],E[1]),u=E,p=d,a=w},lineEnd:function(){p&&o.lineEnd(),u=null},clean:function(){return y|(h&&p)<<1}}}function g(o,u,a){var p=j(o),h=j(u),y=[1,0,0],S=hn(p,h),N=un(S,S),E=S[0],m=N-E*E;if(!m)return!a&&o;var d=t*N/m,w=-t*E/m,R=hn(y,S),L=fn(y,d),T=fn(S,w);dn(L,T);var x=R,I=un(L,x),M=un(x,x),q=I*I-M*(un(L,L)-1);if(!(q<0)){var A=Sn(q),_=fn(x,(-I-A)/M);if(dn(_,L),_=mn(_),!a)return _;var s=o[0],P=u[0],$=o[1],H=u[1],X;P<s&&(X=s,s=P,P=X);var b=P-s,V=O(b-F)<C,U=V||b<C;if(!V&&H<$&&(X=$,$=H,H=X),U?V?$+H>0^_[1]<(O(_[0]-s)<C?$:H):$<=_[1]&&_[1]<=H:b>F^(s<=_[0]&&_[0]<=P)){var K=fn(x,(-I+A)/M);return dn(K,L),[_,mn(K)]}}}function v(o,u){var a=e?n:F-n,p=0;return o<-a?p|=1:o>a&&(p|=2),u<-a?p|=4:u>a&&(p|=8),p}return Qn(f,c,l,e?[0,-n]:[-F,n-F])}function Ct(n,t,i,e,r,l){var f=n[0],c=n[1],g=t[0],v=t[1],o=0,u=1,a=g-f,p=v-c,h;if(h=i-f,!(!a&&h>0)){if(h/=a,a<0){if(h<o)return;h<u&&(u=h)}else if(a>0){if(h>u)return;h>o&&(o=h)}if(h=r-f,!(!a&&h<0)){if(h/=a,a<0){if(h>u)return;h>o&&(o=h)}else if(a>0){if(h<o)return;h<u&&(u=h)}if(h=e-c,!(!p&&h>0)){if(h/=p,p<0){if(h<o)return;h<u&&(u=h)}else if(p>0){if(h>u)return;h>o&&(o=h)}if(h=l-c,!(!p&&h<0)){if(h/=p,p<0){if(h>u)return;h>o&&(o=h)}else if(p>0){if(h<o)return;h<u&&(u=h)}return o>0&&(n[0]=f+o*a,n[1]=c+o*p),u<1&&(t[0]=f+u*a,t[1]=c+u*p),!0}}}}}var tn=1e9,cn=-tn;function It(n,t,i,e){function r(v,o){return n<=v&&v<=i&&t<=o&&o<=e}function l(v,o,u,a){var p=0,h=0;if(v==null||(p=f(v,u))!==(h=f(o,u))||g(v,o)<0^u>0)do a.point(p===0||p===3?n:i,p>1?e:t);while((p=(p+u+4)%4)!==h);else a.point(o[0],o[1])}function f(v,o){return O(v[0]-n)<C?o>0?0:3:O(v[0]-i)<C?o>0?2:1:O(v[1]-t)<C?o>0?1:0:o>0?3:2}function c(v,o){return g(v.x,o.x)}function g(v,o){var u=f(v,1),a=f(o,1);return u!==a?u-a:u===0?o[1]-v[1]:u===1?v[0]-o[0]:u===2?v[1]-o[1]:o[0]-v[0]}return function(v){var o=v,u=Kn(),a,p,h,y,S,N,E,m,d,w,R,L={point:T,lineStart:q,lineEnd:A,polygonStart:I,polygonEnd:M};function T(s,P){r(s,P)&&o.point(s,P)}function x(){for(var s=0,P=0,$=p.length;P<$;++P)for(var H=p[P],X=1,b=H.length,V=H[0],U,K,ln=V[0],Q=V[1];X<b;++X)U=ln,K=Q,V=H[X],ln=V[0],Q=V[1],K<=e?Q>e&&(ln-U)*(e-K)>(Q-K)*(n-U)&&++s:Q<=e&&(ln-U)*(e-K)<(Q-K)*(n-U)&&--s;return s}function I(){o=u,a=[],p=[],R=!0}function M(){var s=x(),P=R&&s,$=(a=Xn(a)).length;(P||$)&&(v.polygonStart(),P&&(v.lineStart(),l(null,null,1,v),v.lineEnd()),$&&Un(a,c,s,l,v),v.polygonEnd()),o=v,a=p=h=null}function q(){L.point=_,p&&p.push(h=[]),w=!0,d=!1,E=m=NaN}function A(){a&&(_(y,S),N&&d&&u.rejoin(),a.push(u.result())),L.point=T,d&&o.lineEnd()}function _(s,P){var $=r(s,P);if(p&&h.push([s,P]),w)y=s,S=P,N=$,w=!1,$&&(o.lineStart(),o.point(s,P));else if($&&d)o.point(s,P);else{var H=[E=Math.max(cn,Math.min(tn,E)),m=Math.max(cn,Math.min(tn,m))],X=[s=Math.max(cn,Math.min(tn,s)),P=Math.max(cn,Math.min(tn,P))];Ct(H,X,n,t,i,e)?(d||(o.lineStart(),o.point(H[0],H[1])),o.point(X[0],X[1]),$||o.lineEnd(),R=!1):$&&(o.lineStart(),o.point(s,P),R=!1)}E=s,m=P,d=$}return L}}const Dn=n=>n;var k=1/0,vn=k,on=-k,gn=on,qn={point:Ot,lineStart:nn,lineEnd:nn,polygonStart:nn,polygonEnd:nn,result:function(){var n=[[k,vn],[on,gn]];return on=gn=-(vn=k=1/0),n}};function Ot(n,t){n<k&&(k=n),n>on&&(on=n),t<vn&&(vn=t),t>gn&&(gn=t)}function Pn(n){return function(t){var i=new Nn;for(var e in n)i[e]=n[e];return i.stream=t,i}}function Nn(){}Nn.prototype={constructor:Nn,point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Fn(n,t,i){var e=n.clipExtent&&n.clipExtent();return n.scale(150).translate([0,0]),e!=null&&n.clipExtent(null),Mt(i,n.stream(qn)),t(qn.result()),e!=null&&n.clipExtent(e),n}function Zn(n,t,i){return Fn(n,function(e){var r=t[1][0]-t[0][0],l=t[1][1]-t[0][1],f=Math.min(r/(e[1][0]-e[0][0]),l/(e[1][1]-e[0][1])),c=+t[0][0]+(r-f*(e[1][0]+e[0][0]))/2,g=+t[0][1]+(l-f*(e[1][1]+e[0][1]))/2;n.scale(150*f).translate([c,g])},i)}function At(n,t,i){return Zn(n,[[0,0],t],i)}function Gt(n,t,i){return Fn(n,function(e){var r=+t,l=r/(e[1][0]-e[0][0]),f=(r-l*(e[1][0]+e[0][0]))/2,c=-l*e[0][1];n.scale(150*l).translate([f,c])},i)}function Bt(n,t,i){return Fn(n,function(e){var r=+t,l=r/(e[1][1]-e[0][1]),f=-l*e[0][0],c=(r-l*(e[1][1]+e[0][1]))/2;n.scale(150*l).translate([f,c])},i)}var Hn=16,zt=G(30*z);function Yn(n,t){return+t?Dt(n,t):$t(n)}function $t(n){return Pn({point:function(t,i){t=n(t,i),this.stream.point(t[0],t[1])}})}function Dt(n,t){function i(e,r,l,f,c,g,v,o,u,a,p,h,y,S){var N=v-e,E=o-r,m=N*N+E*E;if(m>4*t&&y--){var d=f+a,w=c+p,R=g+h,L=Sn(d*d+w*w+R*R),T=rn(R/=L),x=O(O(R)-1)<C||O(l-u)<C?(l+u)/2:en(w,d),I=n(x,T),M=I[0],q=I[1],A=M-e,_=q-r,s=E*A-N*_;(s*s/m>t||O((N*A+E*_)/m-.5)>.3||f*a+c*p+g*h<zt)&&(i(e,r,l,f,c,g,M,q,x,d/=L,w/=L,R,y,S),S.point(M,q),i(M,q,x,d,w,R,v,o,u,a,p,h,y,S))}}return function(e){var r,l,f,c,g,v,o,u,a,p,h,y,S={point:N,lineStart:E,lineEnd:d,polygonStart:function(){e.polygonStart(),S.lineStart=w},polygonEnd:function(){e.polygonEnd(),S.lineStart=E}};function N(T,x){T=n(T,x),e.point(T[0],T[1])}function E(){u=NaN,S.point=m,e.lineStart()}function m(T,x){var I=j([T,x]),M=n(T,x);i(u,a,o,p,h,y,u=M[0],a=M[1],o=T,p=I[0],h=I[1],y=I[2],Hn,e),e.point(u,a)}function d(){S.point=N,e.lineEnd()}function w(){E(),S.point=R,S.lineEnd=L}function R(T,x){m(r=T,x),l=u,f=a,c=p,g=h,v=y,S.point=m}function L(){i(u,a,o,p,h,y,l,f,r,c,g,v,Hn,e),S.lineEnd=d,d()}return S}}var qt=Pn({point:function(n,t){this.stream.point(n*z,t*z)}});function Ht(n){return Pn({point:function(t,i){var e=n(t,i);return this.stream.point(e[0],e[1])}})}function Yt(n,t,i,e,r){function l(f,c){return f*=e,c*=r,[t+n*f,i-n*c]}return l.invert=function(f,c){return[(f-t)/n*e,(i-c)/n*r]},l}function Wn(n,t,i,e,r,l){if(!l)return Yt(n,t,i,e,r);var f=G(l),c=B(l),g=f*n,v=c*n,o=f/n,u=c/n,a=(c*i-f*t)/n,p=(c*t+f*i)/n;function h(y,S){return y*=e,S*=r,[g*y-v*S+t,i-v*y-g*S]}return h.invert=function(y,S){return[e*(o*y-u*S+a),r*(p-u*y-o*S)]},h}function Wt(n){return Xt(function(){return n})()}function Xt(n){var t,i=150,e=480,r=250,l=0,f=0,c=0,g=0,v=0,o,u=0,a=1,p=1,h=null,y=$n,S=null,N,E,m,d=Dn,w=.5,R,L,T,x,I;function M(s){return T(s[0]*z,s[1]*z)}function q(s){return s=T.invert(s[0],s[1]),s&&[s[0]*W,s[1]*W]}M.stream=function(s){return x&&I===s?x:x=qt(Ht(o)(y(R(d(I=s)))))},M.preclip=function(s){return arguments.length?(y=s,h=void 0,_()):y},M.postclip=function(s){return arguments.length?(d=s,S=N=E=m=null,_()):d},M.clipAngle=function(s){return arguments.length?(y=+s?_t(h=s*z):(h=null,$n),_()):h*W},M.clipExtent=function(s){return arguments.length?(d=s==null?(S=N=E=m=null,Dn):It(S=+s[0][0],N=+s[0][1],E=+s[1][0],m=+s[1][1]),_()):S==null?null:[[S,N],[E,m]]},M.scale=function(s){return arguments.length?(i=+s,A()):i},M.translate=function(s){return arguments.length?(e=+s[0],r=+s[1],A()):[e,r]},M.center=function(s){return arguments.length?(l=s[0]%360*z,f=s[1]%360*z,A()):[l*W,f*W]},M.rotate=function(s){return arguments.length?(c=s[0]%360*z,g=s[1]%360*z,v=s.length>2?s[2]%360*z:0,A()):[c*W,g*W,v*W]},M.angle=function(s){return arguments.length?(u=s%360*z,A()):u*W},M.reflectX=function(s){return arguments.length?(a=s?-1:1,A()):a<0},M.reflectY=function(s){return arguments.length?(p=s?-1:1,A()):p<0},M.precision=function(s){return arguments.length?(R=Yn(L,w=s*s),_()):Sn(w)},M.fitExtent=function(s,P){return Zn(M,s,P)},M.fitSize=function(s,P){return At(M,s,P)},M.fitWidth=function(s,P){return Gt(M,s,P)},M.fitHeight=function(s,P){return Bt(M,s,P)};function A(){var s=Wn(i,0,0,a,p,u).apply(null,t(l,f)),P=Wn(i,e-s[0],r-s[1],a,p,u);return o=Vn(c,g,v),L=wn(t,P),T=wn(o,L),R=Yn(L,w),_()}function _(){return x=I=null,M}return function(){return t=n.apply(this,arguments),M.invert=t.invert&&q,A()}}function Tn(n,t){return[n,dt(Et((Y+t)/2))]}Tn.invert=function(n,t){return[n,2*Jn(St(t))-Y]};function Jt(){return Vt(Tn).scale(961/J)}function Vt(n){var t=Wt(n),i=t.center,e=t.scale,r=t.translate,l=t.clipExtent,f=null,c,g,v;t.scale=function(u){return arguments.length?(e(u),o()):e()},t.translate=function(u){return arguments.length?(r(u),o()):r()},t.center=function(u){return arguments.length?(i(u),o()):i()},t.clipExtent=function(u){return arguments.length?(u==null?f=c=g=v=null:(f=+u[0][0],c=+u[0][1],g=+u[1][0],v=+u[1][1]),o()):f==null?null:[[f,c],[g,v]]};function o(){var u=F*e(),a=t(wt(t.rotate()).invert([0,0]));return l(f==null?[[a[0]-u,a[1]-u],[a[0]+u,a[1]+u]]:n===Tn?[[Math.max(a[0]-u,f),c],[Math.min(a[0]+u,g),v]]:[[f,Math.max(a[1]-u,c)],[g,Math.min(a[1]+u,v)]])}return o()}function jn(n,t){function i(e){const r=e.type,l=e.coordinates;switch(r){case"Point":return t(l);case"MultiPoint":return l.map(f=>t(f));case"LineString":return l.map(f=>t(f));case"MultiLineString":return l.map(f=>f.map(c=>t(c)));case"Polygon":return l.map(f=>f.map(c=>t(c)));case"MultiPolygon":return l.map(f=>f.map(c=>c.map(g=>t(g))));case"GeometryCollection":return{type:"GeometryCollection",geometries:e.geometries.map(f=>i(f))};default:throw new Error("Unsupported geometry type: "+r)}}return n.type==="Feature"?{type:"Feature",geometry:i(n.geometry),properties:n.properties}:n.type==="FeatureCollection"?{type:"FeatureCollection",features:n.features.map(e=>jn(e,t))}:(n.type==="GeometryCollection",i(n))}const Kt=(n,t)=>{const i=new at;return n[0].forEach((e,r)=>{const[l,f]=e.map((c,g)=>c);r===0?i.moveTo(l,f):r+1===n[0].length?i.closePath():i.lineTo(l,f)}),new ct(i,{steps:1,depth:t,bevelEnabled:!1})},Ut=async(n,t,i)=>{const e=await fetch(n).then(c=>c.json()),r=Jt().fitExtent([[0,0],[30,30]],e),l=jn(e,r),f=Qt({data:l,fill:t.fill,stroke:t.stroke});i(f)};function Qt({data:n,fill:t,stroke:i}=props){const e=[];return n.features.filter(r=>r.geometry).forEach(r=>{const l=Kt(r.geometry,.01),f=new it().makeRotationX(Math.PI/-2);l.applyMatrix4(f);const c=new rt({color:t}),g=new ot(l,c);g.userData={properties:r.properties};const v=new lt(l),o=new ut({color:i}),u=new ft(v,o);e.push({mesh:g,edges:u,properties:r.properties})}),e}const Zt=({name:n,position:t,floorData:i,visible:e,edgesOnly:r})=>{const[l,f]=Z.useState(!0),{positionSpring:c}=st({positionSpring:e?t:[t[0],t[1]+2,t[2]],config:{mass:1,tension:170,friction:26},onStart:()=>{f(!0)},onRest:()=>{f(e)}});return D.jsx(pt.group,{name:n,position:c,visible:l,children:i.map((g,v)=>D.jsx("group",{name:`${n}_${g.name}`,"position-y":g.positionY,children:g.meshes.map(({mesh:o,edges:u,properties:a},p)=>D.jsxs("group",{children:[!r&&D.jsx("primitive",{object:o,onClick:h=>{if(!e)return;const y=document.querySelector("#tooltip"),S=y.clientWidth;y.style.visibility="visible",y.style.top=`${h.layerY}px`,y.style.left=`${h.layerX-S/2}px`;const E="<table>"+Object.keys(a).map(m=>`<tr><th>${m}</th><td>${a[m]}</td></tr>`).join("")+"</table>";y.innerHTML=E,h.stopPropagation()},onPointerOut:()=>{console.log("pointout")}}),D.jsx("primitive",{object:u})]},p))},v))})};function jt(){const n=Z.useRef(),{camera:t,gl:i}=kn();bn(()=>{n.current.update()});const[e,r]=Z.useState({}),l=xn("ワイヤーフレーム",{edgesOnly:{value:!1,label:"on"}}),f=xn("フロア表示",{NRT2_4out:{value:!0,label:"4階(out)"},NRT2_4:{value:!0,label:"4階"},NRT2_3out:{value:!0,label:"3階(out)"},NRT2_3:{value:!0,label:"3階"},NRT2_2:{value:!0,label:"2階"},NRT2_1:{value:!0,label:"1階"},NRT2_B1:{value:!0,label:"地下1階"},NRT2_B1out:{value:!0,label:"地下1階(駐車場)"},NRT2_B2:{value:!0,label:"地下2階(駐車場)"}});return Z.useEffect(()=>{if(n.current){const c=()=>{const g=document.querySelector("#tooltip");g.style.visibility="hidden",g.innerHTML=""};return n.current.addEventListener("change",c),()=>{n.current.removeEventListener("change",c)}}},[n]),Z.useEffect(()=>{[{floor:"NRT2_B2",position:[-15,-4,15],files:["Space","Fixture","Floor"],colors:[65280,16711680,16753920]},{floor:"NRT2_B1out",position:[-15,-2,15],files:["Space","Fixture","Floor"],colors:[65280,16711680,16753920]},{floor:"NRT2_B1",position:[-15,-2,15],files:["Space","Fixture","Floor"],colors:[65280,16711680,16753920]},{floor:"NRT2_1",position:[-15,0,15],files:["Space","Fixture","Floor"],colors:[65280,16711680,16753920]},{floor:"NRT2_2",position:[-15,2,15],files:["Space","Fixture","Floor"],colors:[65280,16711680,16753920]},{floor:"NRT2_3",position:[-15,4,15],files:["Space","Fixture","Floor"],colors:[65280,16711680,16753920]},{floor:"NRT2_3out",position:[-15,4,15],files:["Space","Fixture","Floor"],colors:[65280,16711680,16753920]},{floor:"NRT2_4",position:[-15,6,15],files:["Space","Fixture","Floor"],colors:[65280,16711680,16753920]},{floor:"NRT2_4out",position:[-15,6,15],files:["Space","Fixture","Floor"],colors:[65280,16711680,16753920]}].forEach(async({floor:g,position:v,files:o,colors:u})=>{const a=[];for(let p=0;p<o.length;p++){const[h,y]=[o[p],u[p]];await Ut(`./data/${g}/${g}_${h}.geojson`,{fill:y,stroke:255},S=>{a.push({name:h,positionY:p===0?0:p===1?.05:-.05,meshes:S})})}r(p=>({...p,[g]:{position:v,floorData:a}}))})},[]),D.jsxs(D.Fragment,{children:[D.jsx(tt,{ref:n,args:[t,i.domElement],enableDamping:!0,dampingFactor:.05,minDistance:1,maxAzimuthAngle:500,maxPolarAngle:Math.PI/2}),D.jsx("ambientLight",{intensity:10}),Object.entries(e).map(([c,{position:g,floorData:v}])=>D.jsx(Zt,{name:c,position:g,floorData:v,visible:f[c],edgesOnly:l.edgesOnly},c))]})}function kt(){return D.jsxs(D.Fragment,{children:[D.jsx(nt,{shadows:!0,camera:{position:[-15,10,-5]},children:D.jsx(jt,{})}),D.jsx("div",{id:"tooltip"})]})}et(document.getElementById("root")).render(D.jsx(Z.StrictMode,{children:D.jsx(kt,{})}));
